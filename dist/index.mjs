var e=function(e,t){try{return Promise.resolve(e.$$eval("body *:not(script):not(style)",function(e,t){Array.from(e).forEach(function(e){if(e.getBoundingClientRect().top+pageYOffset>t)try{e.remove()}catch(e){console.log(e)}})},t)).then(function(){return Promise.resolve(e.content())})}catch(e){return Promise.reject(e)}},t=require("http-server"),r=require("puppeteer"),n=require("dropcss"),o=require("axios").get;function i(e,t,r,o,i){var s=n({html:e,css:r,shouldDrop:function(e){return!o.test(e)}}),u=n({html:t,css:r,shouldDrop:function(e){return!o.test(e)}}),l=new Set;s.sels.forEach(function(e){return l.add(e)}),u.sels.forEach(function(e){return l.add(e)});var c=n({html:"",css:r,shouldDrop:function(e){return!l.has(e)}}),h=n({html:"",css:r,shouldDrop:function(e){return l.has(e)}});if(i){var f=require("csso");c.css=f.minify(c.css).css,h.css=f.minify(h.css).css}return{critical:c.css,rest:h.css}}module.exports=function(n){try{return Promise.resolve(function(){if("HTML"===n.type){var s=n.html,u=void 0===s?"":s,l=n.css,c=void 0===l?"":l,h=n.whitelist,f=void 0===h?/#fooBazBarAboveTheFold8917/:h,a=n.minify,v=void 0!==a&&a;return Promise.resolve(r.launch()).then(function(t){return Promise.resolve(t.newPage()).then(function(r){return Promise.resolve(r.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(r.setContent(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(r.addStyleTag({content:c})).then(function(){return Promise.resolve(r.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(t.newPage()).then(function(n){return Promise.resolve(n.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(n.setContent(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(n.addStyleTag({content:c})).then(function(){return Promise.resolve(n.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(r,1200)).then(function(r){return Promise.resolve(e(n,650)).then(function(e){return Promise.resolve(t.close()).then(function(){return i(r,e,c,f,v)})})})})})})})})})})})})})})}return function(){if("URL"===n.type){var s=n.URL,u=void 0===s?"":s,l=n.enableGoogleFonts,c=void 0===l?0:l,h=n.whitelist,f=void 0===h?/#fooBazBarAboveTheFold8917/:h,a=n.minify,v=void 0!==a&&a;return Promise.resolve(r.launch()).then(function(t){return Promise.resolve(t.newPage()).then(function(r){return Promise.resolve(r.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(r.goto(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(r.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(r.$$eval("link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(n){return c||(n=n.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(t.newPage()).then(function(s){return Promise.resolve(s.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(s.goto(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(s.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(r,1200)).then(function(r){return Promise.resolve(e(s,650)).then(function(e){return Promise.resolve(t.close()).then(function(){var t="";return Promise.resolve(Promise.all(n.map(function(e){try{return Promise.resolve(o(e)).then(function(e){t+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){return i(r,e,t,f,v)})})})})})})})})})})})})})})}return function(){if("localServer"===n.type){var s=n.entrypoint,u=n.filename,l=void 0===u?"index.html":u,c=n.enableGoogleFonts,h=void 0===c?0:c,f=n.whitelist,a=void 0===f?/#fooBazBarAboveTheFold8917/:f,v=n.minify,m=void 0!==v&&v,P=t.createServer({root:void 0===s?"":s});return P.listen(6543),Promise.resolve(r.launch()).then(function(t){return Promise.resolve(t.newPage()).then(function(r){return Promise.resolve(r.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(r.goto("http://127.0.0.1:6543/"+l,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(r.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(r.$$eval("link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(n){return h||(n=n.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(t.newPage()).then(function(s){return Promise.resolve(s.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(s.goto("http://127.0.0.1:6543/"+l,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(s.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(r,1200)).then(function(r){return Promise.resolve(e(s,650)).then(function(e){return Promise.resolve(t.close()).then(function(){var t="";return Promise.resolve(Promise.all(n.map(function(e){try{return Promise.resolve(o(e)).then(function(e){t+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){return P.close(),i(r,e,t,a,m)})})})})})})})})})})})})})})}}()}()}())}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=index.mjs.map
