!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){var e=function(e){try{return Promise.resolve(o.launch()).then(function(n){var o="";return Promise.resolve(n.newPage()).then(function(r){return Promise.resolve(r.setDefaultNavigationTimeout(12e4)).then(function(){return Promise.resolve(r.setViewport({width:1920,height:1200})).then(function(){function s(){return Promise.resolve(n.newPage()).then(function(i){return Promise.resolve(i.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(i.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){function s(){return Promise.resolve(t(r,1200)).then(function(e){return Promise.resolve(t(i,650)).then(function(t){return Promise.resolve(n.close()).then(function(){return{aboveTheFold:e,aboveTheFoldMob:t,css:o}})})})}var u="HTML"===e.type?Promise.resolve(i.setContent(e.html,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(i.addStyleTag({content:e.css})).then(function(){})}):Promise.resolve(i.goto(e.url,{waitUntil:"networkidle2"})).then(function(){});return u&&u.then?u.then(s):s()})})})}var u="HTML"===e.type?Promise.resolve(r.setContent(e.html,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(r.addStyleTag({content:e.css})).then(function(){})}):Promise.resolve(r.goto(e.url,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(r.$$eval(":not(noscript) > link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(t){return e.enableGoogleFonts||(t=t.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(Promise.all(t.map(function(e){try{return Promise.resolve(i(e)).then(function(e){o+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){})})});return u&&u.then?u.then(s):s()})})})})}catch(e){return Promise.reject(e)}},t=function(e,t){try{return Promise.resolve(e.$$eval("body *:not(script):not(style)",function(e,t){Array.from(e).forEach(function(e){try{var n,o=window.getComputedStyle(e),r=0,i=o.top;if(-1!==i.indexOf("px")?r=Math.abs(Number.parseInt(i,10)):-1!==i.indexOf("%")&&(r=e.parentElement.offsetHeight*Math.abs(Number.parseInt(i,10))/100),n=Math.abs(Number.parseInt(o.marginTop,10)),e.getBoundingClientRect().top-n-r+pageYOffset>t)e.remove();else{var s=window.getComputedStyle(e.parentElement);"none"!==s.display&&("hidden"!==s.overflow||"0px"!==s.height&&"0px"!==s.width)||e.remove()}}catch(e){console.error(e)}})},t)).then(function(){return Promise.resolve(e.content())})}catch(e){return Promise.reject(e)}},n=require("http-server"),o=require("puppeteer"),r=require("dropcss"),i=require("axios").get;function s(e,t,n,o,i){var s=r({css:n,html:e,shouldDrop:function(e){return!o.test(e)}}),u=r({css:n,html:t,shouldDrop:function(e){return!o.test(e)}}),l=new Set;s.sels.forEach(function(e){return l.add(e)}),u.sels.forEach(function(e){return l.add(e)});var c=r({css:n,html:"",shouldDrop:function(e){return!l.has(e)}}),a=r({css:n,html:"",shouldDrop:function(e){return l.has(e)}});if(i){var h=require("csso");c.css=h.minify(c.css).css,a.css=h.minify(a.css).css}return{critical:c.css,rest:a.css}}module.exports=function(t){try{return Promise.resolve(function(){if("HTML"===t.type){var o=t.html,r=t.css,i=void 0===r?"":r,u=t.whitelist,l=void 0===u?/#fooBazBarAboveTheFold8917/:u,c=t.minify,a=void 0!==c&&c;return Promise.resolve(e({html:void 0===o?"":o,css:i,type:t.type})).then(function(e){return s(e.aboveTheFold,e.aboveTheFoldMob,i,l,a)})}return function(){if("URL"===t.type){var o=t.URL,r=t.enableGoogleFonts,i=t.whitelist,u=void 0===i?/#fooBazBarAboveTheFold8917/:i,l=t.minify,c=void 0!==l&&l;return Promise.resolve(e({enableGoogleFonts:void 0===r?0:r,url:void 0===o?"":o,type:t.type})).then(function(e){return s(e.aboveTheFold,e.aboveTheFoldMob,e.css,u,c)})}return function(){if("localServer"===t.type){var o=t.entrypoint,r=t.filename,i=void 0===r?"index.html":r,u=t.enableGoogleFonts,l=void 0===u?0:u,c=t.whitelist,a=void 0===c?/#fooBazBarAboveTheFold8917/:c,h=t.minify,f=void 0!==h&&h,v=n.createServer({root:void 0===o?"":o});return v.listen(6543),Promise.resolve(e({enableGoogleFonts:l,url:"http://127.0.0.1:6543/"+i,type:t.type})).then(function(e){var t=e.aboveTheFold,n=e.aboveTheFoldMob,o=e.css;return v.close(),s(t,n,o,a,f)})}}()}()}())}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=index.umd.js.map
