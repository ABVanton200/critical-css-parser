!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){var e=function(e,t){try{return Promise.resolve(e.$$eval("body *:not(script):not(style)",function(e,t){Array.from(e).forEach(function(e){if(e.getBoundingClientRect().top+pageYOffset>t)try{e.remove()}catch(e){console.log(e)}})},t)).then(function(){return Promise.resolve(e.content())})}catch(e){return Promise.reject(e)}},t=require("http-server"),n=require("puppeteer"),r=require("dropcss"),o=require("axios").get;function i(e,t,n,o,i){var s=r({html:e,css:n,shouldDrop:function(e){return!o.test(e)}}),u=r({html:t,css:n,shouldDrop:function(e){return!o.test(e)}}),l=new Set;s.sels.forEach(function(e){return l.add(e)}),u.sels.forEach(function(e){return l.add(e)});var c=r({html:"",css:n,shouldDrop:function(e){return!l.has(e)}}),f=r({html:"",css:n,shouldDrop:function(e){return l.has(e)}});if(i){var h=require("csso");c.css=h.minify(c.css).css,f.css=h.minify(f.css).css}return{critical:c.css,rest:f.css}}module.exports=function(r){try{return Promise.resolve(function(){if("HTML"===r.type){var s=r.html,u=void 0===s?"":s,l=r.css,c=void 0===l?"":l,f=r.whitelist,h=void 0===f?/#fooBazBarAboveTheFold8917/:f,a=r.minify,v=void 0!==a&&a;return Promise.resolve(n.launch()).then(function(t){return Promise.resolve(t.newPage()).then(function(n){return Promise.resolve(n.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(n.setContent(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(n.addStyleTag({content:c})).then(function(){return Promise.resolve(n.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(t.newPage()).then(function(r){return Promise.resolve(r.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(r.setContent(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(r.addStyleTag({content:c})).then(function(){return Promise.resolve(r.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(n,1200)).then(function(n){return Promise.resolve(e(r,650)).then(function(e){return Promise.resolve(t.close()).then(function(){return i(n,e,c,h,v)})})})})})})})})})})})})})})}return function(){if("URL"===r.type){var s=r.URL,u=void 0===s?"":s,l=r.enableGoogleFonts,c=void 0===l?0:l,f=r.whitelist,h=void 0===f?/#fooBazBarAboveTheFold8917/:f,a=r.minify,v=void 0!==a&&a;return Promise.resolve(n.launch()).then(function(t){return Promise.resolve(t.newPage()).then(function(n){return Promise.resolve(n.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(n.goto(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(n.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(n.$$eval("link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(r){return c||(r=r.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(t.newPage()).then(function(s){return Promise.resolve(s.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(s.goto(u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(s.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(n,1200)).then(function(n){return Promise.resolve(e(s,650)).then(function(e){return Promise.resolve(t.close()).then(function(){var t="";return Promise.resolve(Promise.all(r.map(function(e){try{return Promise.resolve(o(e)).then(function(e){t+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){return i(n,e,t,h,v)})})})})})})})})})})})})})})}return function(){if("localServer"===r.type){var s=r.entrypoint,u=r.filename,l=void 0===u?"index.html":u,c=r.enableGoogleFonts,f=void 0===c?0:c,h=r.whitelist,a=void 0===h?/#fooBazBarAboveTheFold8917/:h,v=r.minify,m=void 0!==v&&v,P=t.createServer({root:void 0===s?"":s});return P.listen(6543),Promise.resolve(n.launch()).then(function(t){return Promise.resolve(t.newPage()).then(function(n){return Promise.resolve(n.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(n.goto("http://127.0.0.1:6543/"+l,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(n.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(n.$$eval("link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(r){return f||(r=r.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(t.newPage()).then(function(s){return Promise.resolve(s.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(s.goto("http://127.0.0.1:6543/"+l,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(s.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(n,1200)).then(function(n){return Promise.resolve(e(s,650)).then(function(e){return Promise.resolve(t.close()).then(function(){var t="";return Promise.resolve(Promise.all(r.map(function(e){try{return Promise.resolve(o(e)).then(function(e){t+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){return P.close(),i(n,e,t,a,m)})})})})})})})})})})})})})})}}()}()}())}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=index.umd.js.map
